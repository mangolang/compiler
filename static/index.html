<!-- TODO: NOTICE: -->
<!-- TODO: This is a simple wasm demo of the compiler. -->
<!-- TODO: The 'real' version should be in github.com/mangolang/website. -->

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" name="viewport"/>
	<style type="text/css" media="screen">
		body {
			background-color: orange;
		}
		
		#content {
			background-color: #EEE;
			max-width: 1000px;
			margin: 0 auto;
		}
		
		#editor {
			width: 100%;
			height: 600px;
		}
		
		#output {
			background-color: #DDD;
			border: 1px solid black;
			min-height: 150px;
		}
	</style>
</head>
<body>
<main>
	<section id="content">
		<h1>Mango (wasm)</h1>
		<div id="editor">// Type your Mango code here!
		
		</div>
		<button id="compile_wat" onclick="alert('Not ready yet, please wait or check console');"
		        title="Compile the code to the ascii text representation of WebAssembly">Compile to wat
		</button>
		<button onclick="alert('Not implemented');" title="Compile the code to binary, executable WebAssembly">Compile to wasm
		</button>
		<button onclick="alert('Not implemented');"
		        title="Compile the code to binary WebAssembly and run it, showing only the output">Compile and run
		</button>
		<div id="output"></div>
	</section>
</main>

<!-- Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/theme-crimson_editor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/mode-javascript.js"></script>

<script type="application/javascript">
    window.editor = ace.edit("editor");
    window.editor.setTheme("ace/theme/crimson_editor");
    window.editor.session.setMode("ace/mode/javascript");
    // window.editor.resize();
</script>

<!--Wasm Mango compiler-->
<script src="./mango.js" type="module"></script>
<script type="module">
    (async function () {
        /**
         * Show a string in the output area, replacing any previous results.
         */
        function show_output(txt) {
            let output = document.getElementById("output");
            output.innerHTML = "";
            let pre = document.createElement("pre");
            pre.innerHTML = txt;
            output.appendChild(pre);
        }

        /**
         * Load the Mango compiler wasm code (async).
         */
        let _ = await window.wasm_bindgen("./mango_bg.wasm");
        let mango = window.wasm_bindgen;

        /**
         * Bind the "compile to wat" button.
         */
        document.getElementById("compile_wat").onclick = function (event) {
            let mangocode = window.editor.getValue();
            console.log("Compiling Mango:\n", mangocode);
            let watcode = mango.compile_string_to_wat(mangocode);
            console.log("Resulting WebAssembly text:\n", watcode);
            show_output(watcode);
        };
    })();
</script>
</body>
</html>
